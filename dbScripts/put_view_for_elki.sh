#!/bin/bash
# PUT the map function to CouchDB databases for the Views of data needed for ELKI clustering process.

curl -X PUT "http://127.0.0.1:5984/bmrh/_design/for_elki" -H "Content-Type:application/json" -d '{"language":"javascript","views":{"st":{"map":"function(doc) {\n  var lat=0.0;\n  var lon=0.0;\n  var created_at;\n  var time_dist_in_sec;\n  var value_for_elki;\n  \n  var harvested_from = new Date(\"Mon Apr 20 00:00:00 +0000 2015\").getTime();\n  \n  if (doc.created_at) {\n    created_at = new Date(doc.created_at).getTime();\n    //the numbers of seconds between a specified date and midnight April 20, 2015\n    time_dist_in_sec = (created_at - harvested_from) / 1000;\n  }\n  if (doc.geo) {\n    lat = doc.geo.coordinates[0]; \n    lon = doc.geo.coordinates[1];\n  } else if (doc.coordinates) {\n    lat = doc.coordinates.coordinates[1]; \n    lon = doc.coordinates.coordinates[0];\n  } else {\n    lat = doc.harvester_appends.geo.latitude; \n    lon = doc.harvester_appends.geo.longitude;\n  }\n  \n  value_for_elki = time_dist_in_sec + \" \" + lat + \" \" + lon;\n  \n  emit(doc.id, value_for_elki);\n}"}}}'

curl -X PUT "http://127.0.0.1:5984/mmrh/_design/for_elki" -H "Content-Type:application/json" -d '{"language":"javascript","views":{"st":{"map":"function(doc) {\n  var lat=0.0;\n  var lon=0.0;\n  var created_at;\n  var time_dist_in_sec;\n  var value_for_elki;\n  \n  var harvested_from = new Date(\"Mon Apr 20 00:00:00 +0000 2015\").getTime();\n  \n  if (doc.created_at) {\n    created_at = new Date(doc.created_at).getTime();\n    //the numbers of seconds between a specified date and midnight April 20, 2015\n    time_dist_in_sec = (created_at - harvested_from) / 1000;\n  }\n  if (doc.geo) {\n    lat = doc.geo.coordinates[0]; \n    lon = doc.geo.coordinates[1];\n  } else if (doc.coordinates) {\n    lat = doc.coordinates.coordinates[1]; \n    lon = doc.coordinates.coordinates[0];\n  } else {\n    lat = doc.harvester_appends.geo.latitude; \n    lon = doc.harvester_appends.geo.longitude;\n  }\n  \n  value_for_elki = time_dist_in_sec + \" \" + lat + \" \" + lon;\n  \n  emit(doc.id, value_for_elki);\n}"}}}'

curl -X PUT "http://127.0.0.1:5984/smrh/_design/for_elki" -H "Content-Type:application/json" -d '{"language":"javascript","views":{"st":{"map":"function(doc) {\n  var lat=0.0;\n  var lon=0.0;\n  var created_at;\n  var time_dist_in_sec;\n  var value_for_elki;\n  \n  var harvested_from = new Date(\"Mon Apr 20 00:00:00 +0000 2015\").getTime();\n  \n  if (doc.created_at) {\n    created_at = new Date(doc.created_at).getTime();\n    //the numbers of seconds between a specified date and midnight April 20, 2015\n    time_dist_in_sec = (created_at - harvested_from) / 1000;\n  }\n  if (doc.geo) {\n    lat = doc.geo.coordinates[0]; \n    lon = doc.geo.coordinates[1];\n  } else if (doc.coordinates) {\n    lat = doc.coordinates.coordinates[1]; \n    lon = doc.coordinates.coordinates[0];\n  } else {\n    lat = doc.harvester_appends.geo.latitude; \n    lon = doc.harvester_appends.geo.longitude;\n  }\n  \n  value_for_elki = time_dist_in_sec + \" \" + lat + \" \" + lon;\n  \n  emit(doc.id, value_for_elki);\n}"}}}'
