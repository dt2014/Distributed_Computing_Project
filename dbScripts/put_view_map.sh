#!/bin/bash
# PUT the map functions to CouchDB databases.

curl -X PUT "http://144.6.227.137:5984/bmrh/_design/map" -H "Content-Type:application/json" -d '{ "_id": "_design/map", "language": "javascript", "views": { "time": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var time;\n var mt; //military time\n var time_tag;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n time = created_at.toLocaleTimeString();\n mt = Number(time.slice(0,5).replace(\":\",\"\"));\n if (mt >= 600 && mt <= 900) {\n time_tag = \"morning rush\";\n } else if (mt >= 1630 && mt <= 1900) {\n time_tag = \"evening rush\";\n } else {\n time_tag = \"off peak\";\n }\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n emit(time_tag, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}\n" }, "day": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var day;\n var days = [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n day = days[new Date(date).getDay()];\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n \n emit(day,{lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" }, "road": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n \n emit(doc.harvester_appends.name, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" }, "date": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var time;\n var date;\n var date_tag;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = new Date(created_at.toLocaleDateString());\n var dd = date.getDate();\n if ( dd < 10 ) dd = '0' + dd;\n var mm = date.getMonth() + 1;\n if ( mm < 10 ) mm = '0' + mm;\n var yy = date.getFullYear();\n date_tag = yy + mm + dd;\n\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n \n }\n \n emit(date_tag, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" } } }'

curl -X PUT "http://144.6.227.137:5984/mmrh/_design/map" -H "Content-Type:application/json" -d '{ "_id": "_design/map", "language": "javascript", "views": { "time": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var time;\n var mt; //military time\n var time_tag;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n time = created_at.toLocaleTimeString();\n mt = Number(time.slice(0,5).replace(\":\",\"\"));\n if (mt >= 600 && mt <= 900) {\n time_tag = \"morning rush\";\n } else if (mt >= 1630 && mt <= 1900) {\n time_tag = \"evening rush\";\n } else {\n time_tag = \"off peak\";\n }\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n emit(time_tag, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}\n" }, "day": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var day;\n var days = [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n day = days[new Date(date).getDay()];\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n \n emit(day,{lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" }, "road": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n \n emit(doc.harvester_appends.name, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" }, "date": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var time;\n var date;\n var date_tag;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = new Date(created_at.toLocaleDateString());\n var dd = date.getDate();\n if ( dd < 10 ) dd = '0' + dd;\n var mm = date.getMonth() + 1;\n if ( mm < 10 ) mm = '0' + mm;\n var yy = date.getFullYear();\n date_tag = yy + mm + dd;\n\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n \n }\n \n emit(date_tag, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" } } }'

curl -X PUT "http://144.6.227.137:5984/smrh/_design/map" -H "Content-Type:application/json" -d '{ "_id": "_design/map", "language": "javascript", "views": { "time": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var time;\n var mt; //military time\n var time_tag;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n time = created_at.toLocaleTimeString();\n mt = Number(time.slice(0,5).replace(\":\",\"\"));\n if (mt >= 600 && mt <= 900) {\n time_tag = \"morning rush\";\n } else if (mt >= 1630 && mt <= 1900) {\n time_tag = \"evening rush\";\n } else {\n time_tag = \"off peak\";\n }\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n emit(time_tag, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}\n" }, "day": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var day;\n var days = [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n day = days[new Date(date).getDay()];\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n \n emit(day,{lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" }, "road": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n }\n \n emit(doc.harvester_appends.name, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" }, "date": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var time;\n var date;\n var date_tag;\n var congestion = false;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = new Date(created_at.toLocaleDateString());\n var dd = date.getDate();\n if ( dd < 10 ) dd = '0' + dd;\n var mm = date.getMonth() + 1;\n if ( mm < 10 ) mm = '0' + mm;\n var yy = date.getFullYear();\n date_tag = yy + mm + dd;\n\n }\n \n if (doc.geo) {\n lat = doc.geo.coordinates[0]; \n lon = doc.geo.coordinates[1];\n } else if (doc.coordinates) {\n lat = doc.coordinates.coordinates[1]; \n lon = doc.coordinates.coordinates[0];\n } else {\n lat = doc.harvester_appends.geo.latitude; \n lon = doc.harvester_appends.geo.longitude;\n }\n \n if (doc.cluster_info) {\n if (doc.cluster_info.cluster_name != \"Noise\") {\n congestion = true;\n }\n \n }\n \n emit(date_tag, {lat:lat,lon:lon,time:created_at,congestion:congestion,road:doc.harvester_appends.name,user:doc.user.screen_name,text:doc.text});\n}" } } }'