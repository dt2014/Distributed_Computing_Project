#!/bin/bash
# PUT the map and reduce functions to CouchDB databases.

curl -X PUT "http://144.6.227.137:5984/bmrh/_design/reduce" -H "Content-Type:application/json" -d '{ "_id": "_design/reduce", "language": "javascript", "views": { "date": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var date_tag;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = new Date(created_at.toLocaleDateString());\n var dd = date.getDate();\n if ( dd < 10 ) dd = '0' + dd;\n var mm = date.getMonth() + 1;\n if ( mm < 10 ) mm = '0' + mm;\n var yy = date.getFullYear();\n date_tag = yy + mm + dd;\n } \n emit(date_tag, 1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "road": { "map": "function(doc) {\n emit(doc.harvester_appends.name, 1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "day": { "map": "function(doc) {\n var created_at;\n var date;\n var day;\n var days = [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n day = days[new Date(date).getDay()];\n }\n \n emit(day,1);\n}", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "time": { "map": "function(doc) {\n var created_at;\n var date;\n var time;\n var mt; //military time\n var time_tag;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n time = created_at.toLocaleTimeString();\n mt = Number(time.slice(0,5).replace(\":\",\"\"));\n if (mt >= 600 && mt <= 900) {\n time_tag = \"morning rush\";\n } else if (mt >= 1630 && mt <= 1900) {\n time_tag = \"evening rush\";\n } else {\n time_tag = \"off peak\";\n }\n }\n\n emit(time_tag,1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" } } }'

curl -X PUT "http://144.6.227.137:5984/mmrh/_design/reduce" -H "Content-Type:application/json" -d '{ "_id": "_design/reduce", "language": "javascript", "views": { "date": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var date_tag;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = new Date(created_at.toLocaleDateString());\n var dd = date.getDate();\n if ( dd < 10 ) dd = '0' + dd;\n var mm = date.getMonth() + 1;\n if ( mm < 10 ) mm = '0' + mm;\n var yy = date.getFullYear();\n date_tag = yy + mm + dd;\n } \n emit(date_tag, 1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "road": { "map": "function(doc) {\n emit(doc.harvester_appends.name, 1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "day": { "map": "function(doc) {\n var created_at;\n var date;\n var day;\n var days = [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n day = days[new Date(date).getDay()];\n }\n \n emit(day,1);\n}", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "time": { "map": "function(doc) {\n var created_at;\n var date;\n var time;\n var mt; //military time\n var time_tag;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n time = created_at.toLocaleTimeString();\n mt = Number(time.slice(0,5).replace(\":\",\"\"));\n if (mt >= 600 && mt <= 900) {\n time_tag = \"morning rush\";\n } else if (mt >= 1630 && mt <= 1900) {\n time_tag = \"evening rush\";\n } else {\n time_tag = \"off peak\";\n }\n }\n\n emit(time_tag,1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" } } }'

curl -X PUT "http://144.6.227.137:5984/smrh/_design/reduce" -H "Content-Type:application/json" -d '{ "_id": "_design/reduce", "language": "javascript", "views": { "date": { "map": "function(doc) {\n var lat=0.0;\n var lon=0.0;\n var created_at;\n var date;\n var date_tag;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = new Date(created_at.toLocaleDateString());\n var dd = date.getDate();\n if ( dd < 10 ) dd = '0' + dd;\n var mm = date.getMonth() + 1;\n if ( mm < 10 ) mm = '0' + mm;\n var yy = date.getFullYear();\n date_tag = yy + mm + dd;\n } \n emit(date_tag, 1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "road": { "map": "function(doc) {\n emit(doc.harvester_appends.name, 1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "day": { "map": "function(doc) {\n var created_at;\n var date;\n var day;\n var days = [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n day = days[new Date(date).getDay()];\n }\n \n emit(day,1);\n}", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" }, "time": { "map": "function(doc) {\n var created_at;\n var date;\n var time;\n var mt; //military time\n var time_tag;\n\n if (doc.created_at) {\n created_at = new Date(doc.created_at);\n date = created_at.toLocaleDateString();\n time = created_at.toLocaleTimeString();\n mt = Number(time.slice(0,5).replace(\":\",\"\"));\n if (mt >= 600 && mt <= 900) {\n time_tag = \"morning rush\";\n } else if (mt >= 1630 && mt <= 1900) {\n time_tag = \"evening rush\";\n } else {\n time_tag = \"off peak\";\n }\n }\n\n emit(time_tag,1);\n}\n", "reduce": "function (key, values, rereduce) {\n return sum(values);\n}" } } }'
